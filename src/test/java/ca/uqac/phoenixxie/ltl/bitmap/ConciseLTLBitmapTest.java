package ca.uqac.phoenixxie.ltl.bitmap;

import org.junit.Test;
import static org.junit.Assert.assertEquals;

import java.util.concurrent.ThreadLocalRandom;

public class ConciseLTLBitmapTest extends LTLBitmapTest {

    @Override
    public LTLBitmap newBm(String in) {
        LTLBitmap bm = new LTLBitmap(LTLBitmap.Type.CONCISE);
        bm.add(in);
        return bm;
    }

    @Test
    public void test1() throws Exception {
        LTLBitmap raw1 = new LTLBitmap(LTLBitmap.Type.RAW);
        LTLBitmap raw2 = new LTLBitmap(LTLBitmap.Type.RAW);
        LTLBitmap bm1 = new LTLBitmap(LTLBitmap.Type.CONCISE);
        LTLBitmap bm2 = new LTLBitmap(LTLBitmap.Type.CONCISE);

        for (int i = 0; i < 500; ++i) {
            boolean b = ThreadLocalRandom.current().nextBoolean();
            raw1.add(b);
            bm1.add(b);
            b = ThreadLocalRandom.current().nextBoolean();
            raw2.add(b);
            bm2.add(b);

            String a1 = raw1.opWeakUntil(raw2).toString();
            String a2 = bm1.opWeakUntil(bm2).toString();

            if (!a1.equals(a2)) {
                System.out.println(raw1.toString());
                System.out.println(raw2.toString());
                System.out.println(a1.toString());
                System.out.println(a2.toString());
                assert false;
            }
        }
    }

    @Test
    public void test2() throws Exception {
        LTLBitmap bm1 = new LTLBitmap(LTLBitmap.Type.CONCISE);
        LTLBitmap bm2 = new LTLBitmap(LTLBitmap.Type.CONCISE);

        bm1.add("11110001001010001000100001110110111101011010011010001001001011001011111100001101001001101101100001010101001111111001111000111001000000111110011101000111100100100000011111010111011111001111111110010101000001111100111011110111010111111111010000110001010000001110111111101001100111111001011111000000011111111000110110010000110110011110111010101101011010110101010011110000110011011000110001001110111110100001111100100001011010100010000010010100101011110101001000010001111001101011000001111001010110101110010110010011000001001111011000000001001001010100011001010101101001101001101011010010101010010110101111001101100000011100010000111010100000000000010110000110010011111100110110011011110000");
        bm2.add("01110011011110011110011000010110100010101111111110101101100101111111001100001001011001011001000101010101111101010100111000010000000101111110101011010000001010110101000111000011001001111011001000110000010110000011011100011111101101111001001011001001011000000000000100010110010001110010101101000111111101000111101101011111000100000001001001100100111001100001000001011100011001001000101011010001110101010010001101001011011100011111110110000000011010000001001110101101000110001110110001100011000101100111101111100010100100010101110001101101001111101101000011111110101011010110010101100101111111001111001110100110000110011011011111101101011011010100010101001000100001101101011110100101010001");
        String a = bm1.opWeakUntil(bm2).toString();
        assertEquals("11110011011110011110111001110110111111111111111110101101101111111111111100001001011001111001000101010101111111111101111000110000000101111110111111010000001110110101011111000111011111111111111000110000010111111111111111111111111111111111011011111001011000000000111111111111110111110011111111000111111111111111111111011111000100011111111011101101111011100001000011111100111011011000111011011111111111110011111101001011011100111111110110000000111010000001001110111101111110001111110001100011000111101111111111100011100100011111110001101101001111111101000011111111101011111111111111100111111111011111001111101110000110011111011111111111111011010100010111001000100011111101111110111111110001", a);
    }
}